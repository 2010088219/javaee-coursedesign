# 订单支付功能测试指南

## 测试前准备

### 1. 数据库准备
确保MySQL/MariaDB服务运行，并创建数据库：
```sql
CREATE DATABASE javaee_shop;
USE javaee_shop;
-- 运行 database.sql 中的建表语句
```

### 2. 启动应用
```bash
cd /workspace/javaee-coursedesign
mvn clean package
# 部署到Tomcat或其他Web服务器
```

## 测试步骤

### 1. 用户注册/登录测试
1. 访问应用首页
2. 注册新用户或使用现有用户登录
3. 确保用户信息中包含收货地址

### 2. 购物车功能测试
1. 浏览商品列表
2. 添加商品到购物车
3. 查看购物车，确保商品正确显示
4. 选择要结算的商品

### 3. 订单结算测试
1. 在购物车页面点击"去结算"
2. 验证跳转到结算页面 (`/order/checkout`)
3. 检查页面显示：
   - 收货地址信息
   - 选中的商品列表
   - 支付方式选择
   - 订单总金额

### 4. 订单提交测试
1. 在结算页面点击"提交订单"
2. 观察浏览器控制台输出：
   ```
   开始支付处理，订单ID: [订单ID], 支付方式: [支付方式]
   发送支付请求...
   支付响应: [响应数据]
   ```
3. 验证订单创建成功的消息

### 5. 支付流程测试

#### 支付成功场景（80%概率）
1. 观察控制台输出：
   ```
   支付成功，更新订单状态...
   更新订单状态，订单ID: [ID], 状态: 1
   订单状态更新响应: [响应]
   订单状态更新成功
   ```
2. 验证成功消息："支付成功！订单已完成"
3. 等待2秒后自动跳转到"我的订单"页面
4. 在订单列表中找到新创建的订单
5. 验证订单状态为"已支付"

#### 支付失败场景（20%概率）
1. 观察控制台输出：
   ```
   支付失败: [失败原因]
   ```
2. 验证失败消息显示
3. 按钮变为"重新支付"
4. 可以点击重新支付按钮重试

### 6. 订单查看测试
1. 访问"我的订单"页面 (`/order/orders`)
2. 验证新创建的订单显示在列表中
3. 检查订单信息：
   - 订单号
   - 商品信息
   - 订单金额
   - 订单状态
   - 创建时间

## 调试技巧

### 1. 浏览器开发者工具
- 打开F12开发者工具
- 查看Console标签页的日志输出
- 查看Network标签页的网络请求

### 2. 关键日志检查
在浏览器控制台中查找以下日志：
- `开始支付处理`
- `发送支付请求`
- `支付响应`
- `支付成功，更新订单状态`
- `订单状态更新成功`

### 3. 网络请求检查
在Network标签页中检查以下请求：
- `POST /order/create` - 创建订单
- `POST /user/payment/status` - 支付状态检查
- `POST /order/updateStatus` - 更新订单状态

## 常见问题排查

### 1. "网络错误，请重试"
- 检查服务器是否正常运行
- 查看浏览器控制台的错误信息
- 检查网络请求的HTTP状态码

### 2. 订单创建失败
- 检查购物车中是否有商品
- 验证用户登录状态
- 检查商品库存是否充足

### 3. 支付状态更新失败
- 检查订单是否存在
- 验证订单属于当前用户
- 检查订单当前状态是否允许支付

### 4. 页面跳转异常
- 检查路由配置
- 验证订单ID是否正确
- 检查用户权限

## 预期结果

### 成功流程
1. 用户能够正常提交订单
2. 支付流程顺利完成（大部分情况下）
3. 订单状态正确更新为"已支付"
4. 用户能在"我的订单"页面查看新订单
5. 购物车中的商品被正确移除

### 错误处理
1. 支付失败时显示明确的错误信息
2. 用户可以重新尝试支付
3. 网络错误时有友好的提示信息
4. 所有异常情况都有适当的处理

## 性能指标
- 订单创建响应时间：< 2秒
- 支付处理时间：1-3秒（模拟延迟）
- 页面跳转时间：< 1秒
- 支付成功率：约80%（测试环境）